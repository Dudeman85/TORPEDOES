<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tiimi Arkade: android-cmake</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tiimi Arkade<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__c_1_2_users_2matia_2source_2repos_2tiimiarkade_2team5_2ext_2assimp-5_80_81_2contrib_2android-cmake_2_r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">android-cmake</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md85"></a> CMake is great, and so is Android. This is a collection of CMake scripts that may be useful to the Android NDK community. It is based on experience from porting OpenCV library to Android: <a href="http://opencv.org/platforms/android.html">http://opencv.org/platforms/android.html</a></p>
<p>Main goal is to share these scripts so that devs that use CMake as their build system may easily compile native code for Android.</p>
<h1><a class="anchor" id="autotoc_md86"></a>
TL;DR</h1>
<pre class="fragment">cmake -DCMAKE_TOOLCHAIN_FILE=android.toolchain.cmake \
      -DANDROID_NDK=&lt;ndk_path&gt;                       \
      -DCMAKE_BUILD_TYPE=Release                     \
      -DANDROID_ABI="armeabi-v7a with NEON"          \
      &lt;source_path&gt;
cmake --build .
</pre><p> One-liner: </p><pre class="fragment">cmake -DCMAKE_TOOLCHAIN_FILE=android.toolchain.cmake -DANDROID_NDK=&lt;ndk_path&gt; -DCMAKE_BUILD_TYPE=Release -DANDROID_ABI="armeabi-v7a with NEON" &lt;source_path&gt; &amp;&amp; cmake --build .
</pre><p> <em>android-cmake</em> will search for your NDK install in the following order:</p>
<ol type="1">
<li><a class="el" href="class_value.html" title="This class implements a value.">Value</a> of <code>ANDROID_NDK</code> CMake variable;</li>
</ol>
<ol type="1">
<li><a class="el" href="class_value.html" title="This class implements a value.">Value</a> of <code>ANDROID_NDK</code> environment variable;</li>
</ol>
<ol type="1">
<li>Search under paths from <code>ANDROID_NDK_SEARCH_PATHS</code> CMake variable;</li>
</ol>
<ol type="1">
<li>Search platform specific locations (home folder, Windows "Program Files", etc).</li>
</ol>
<p>So if you have installed the NDK as <code>~/android-ndk-r10d</code> then <em>android-cmake</em> will locate it automatically.</p>
<h1><a class="anchor" id="autotoc_md87"></a>
Getting started</h1>
<p>To build a cmake-based C/C++ project for Android you need:</p>
<ul>
<li>Android NDK (&gt;= r5) <a href="http://developer.android.com/tools/sdk/ndk/index.html">http://developer.android.com/tools/sdk/ndk/index.html</a></li>
<li>CMake (&gt;= v2.6.3, &gt;= v2.8.9 recommended) <a href="http://www.cmake.org/download">http://www.cmake.org/download</a></li>
</ul>
<p>The <em>android-cmake</em> is also capable to build with NDK from AOSP or Linaro Android source tree, but you may be required to manually specify path to <code>libm</code> binary to link with.</p>
<h1><a class="anchor" id="autotoc_md88"></a>
Difference from traditional CMake</h1>
<p>Folowing the <em>ndk-build</em> the <em>android-cmake</em> supports <b>only two build targets</b>:</p>
<ul>
<li><code>-DCMAKE_BUILD_TYPE=Release</code></li>
<li><code>-DCMAKE_BUILD_TYPE=Debug</code></li>
</ul>
<p>So don't even try other targets that can be found in CMake documentation and don't forget to explicitly specify <code>Release</code> or <code>Debug</code> because CMake builds without a build configuration by default.</p>
<h1><a class="anchor" id="autotoc_md89"></a>
Difference from <em>ndk-build</em></h1>
<ul>
<li>Latest GCC available in NDK is used as the default compiler;</li>
<li><code>Release</code> builds with <code>-O3</code> instead of <code>-Os</code>;</li>
<li><code>Release</code> builds without debug info (without <code>-g</code>) (because <em>ndk-build</em> always creates a stripped version but cmake delays this for <code>install/strip</code> target);</li>
<li><code>-fsigned-char</code> is added to compiler flags to make <code>char</code> signed by default as it is on x86/x86_64;</li>
<li>GCC's stack protector is not used neither in <code>Debug</code> nor <code>Release</code> configurations;</li>
<li>No builds for multiple platforms (e.g. building for both arm and x86 require to run cmake twice with different parameters);</li>
<li>No file level Neon via <code>.neon</code> suffix;</li>
</ul>
<p>The following features of <em>ndk-build</em> are not supported by the <em>android-cmake</em> yet:</p>
<ul>
<li><code>armeabi-v7a-hard</code> ABI</li>
<li><code>libc++_static</code>/<code>libc++_shared</code> STL runtime</li>
</ul>
<h1><a class="anchor" id="autotoc_md90"></a>
Basic options</h1>
<p>Similarly to the NDK build system <em>android-cmake</em> allows to select between several compiler toolchains and target platforms. Most of the options can be set either as cmake arguments: <code>-D&lt;NAME&gt;=&lt;VALUE&gt;</code> or as environment variables:</p>
<ul>
<li><b>ANDROID_NDK</b> - path to the Android NDK. If not set then <em>android-cmake</em> will search for the most recent version of supported NDK in commonly used locations;</li>
<li><b>ANDROID_ABI</b> - specifies the target Application Binary Interface (ABI). This option nearly matches to the APP_ABI variable used by ndk-build tool from Android NDK. If not specified then set to <code>armeabi-v7a</code>. Possible target names are:<ul>
<li><code>armeabi</code> - ARMv5TE based CPU with software floating point operations;</li>
<li>**<code>armeabi-v7a</code>** - ARMv7 based devices with hardware FPU instructions (VFPv3_D16);</li>
<li><code>armeabi-v7a with NEON</code> - same as armeabi-v7a, but sets NEON as floating-point unit;</li>
<li><code>armeabi-v7a with VFPV3</code> - same as armeabi-v7a, but sets VFPv3_D32 as floating-point unit;</li>
<li><code>armeabi-v6 with VFP</code> - tuned for ARMv6 processors having VFP;</li>
<li><code>x86</code> - IA-32 instruction set</li>
<li><code>mips</code> - MIPS32 instruction set</li>
<li><code>arm64-v8a</code> - ARMv8 AArch64 instruction set - only for NDK r10 and newer</li>
<li><code>x86_64</code> - Intel64 instruction set (r1) - only for NDK r10 and newer</li>
<li><code>mips64</code> - MIPS64 instruction set (r6) - only for NDK r10 and newer</li>
</ul>
</li>
<li><p class="startli"><b>ANDROID_NATIVE_API_LEVEL</b> - level of android API to build for. Can be set either to full name (example: <code>android-8</code>) or a numeric value (example: <code>17</code>). The default API level depends on the target ABI:</p><ul>
<li><code>android-8</code> for ARM;</li>
<li><code>android-9</code> for x86 and MIPS;</li>
<li><code>android-21</code> for 64-bit ABIs.</li>
</ul>
<p class="startli">Building for <code>android-L</code> is possible only when it is explicitly selected.</p>
</li>
<li><p class="startli"><b>ANDROID_TOOLCHAIN_NAME</b> - the name of compiler toolchain to be used. This option allows to select between different GCC and Clang versions. The list of possible values depends on the NDK version and will be printed by toolchain file if an invalid value is set. By default <em>android-cmake</em> selects the most recent version of GCC which can build for specified <code>ANDROID_ABI</code>.</p>
<p class="startli">Example values are:</p><ul>
<li><code>aarch64-linux-android-4.9</code></li>
<li><code>aarch64-linux-android-clang3.5</code></li>
<li><code>arm-linux-androideabi-4.8</code></li>
<li><code>arm-linux-androideabi-4.9</code></li>
<li><code>arm-linux-androideabi-clang3.5</code></li>
<li><code>mips64el-linux-android-4.9</code></li>
<li><code>mipsel-linux-android-4.8</code></li>
<li><code>x86-4.9</code></li>
<li><code>x86_64-4.9</code></li>
<li>etc.</li>
</ul>
</li>
<li><b>ANDROID_STL</b> - the name of C++ runtime to use. The default is <code>gnustl_static</code>.<ul>
<li><code>none</code> - do not configure the runtime.</li>
<li><code>system</code> - use the default minimal system C++ runtime library.<ul>
<li>Implies <code>-fno-rtti -fno-exceptions</code>.</li>
</ul>
</li>
<li><code>system_re</code> - use the default minimal system C++ runtime library.<ul>
<li>Implies <code>-frtti -fexceptions</code>.</li>
</ul>
</li>
<li><code>gabi++_static</code> - use the GAbi++ runtime as a static library.<ul>
<li>Implies <code>-frtti -fno-exceptions</code>.</li>
<li>Available for NDK r7 and newer.</li>
</ul>
</li>
<li><code>gabi++_shared</code> - use the GAbi++ runtime as a shared library.<ul>
<li>Implies <code>-frtti -fno-exceptions</code>.</li>
<li>Available for NDK r7 and newer.</li>
</ul>
</li>
<li><code>stlport_static</code> - use the STLport runtime as a static library.<ul>
<li>Implies <code>-fno-rtti -fno-exceptions</code> for NDK before r7.</li>
<li>Implies <code>-frtti -fno-exceptions</code> for NDK r7 and newer.</li>
</ul>
</li>
<li><code>stlport_shared</code> - use the STLport runtime as a shared library.<ul>
<li>Implies <code>-fno-rtti -fno-exceptions</code> for NDK before r7.</li>
<li>Implies <code>-frtti -fno-exceptions</code> for NDK r7 and newer.</li>
</ul>
</li>
<li>**<code>gnustl_static</code>** - use the GNU STL as a static library.<ul>
<li>Implies <code>-frtti -fexceptions</code>.</li>
</ul>
</li>
<li><code>gnustl_shared</code> - use the GNU STL as a shared library.<ul>
<li>Implies <code>-frtti -fno-exceptions</code>.</li>
<li>Available for NDK r7b and newer.</li>
<li>Silently degrades to <code>gnustl_static</code> if not available.</li>
</ul>
</li>
</ul>
</li>
<li><b>NDK_CCACHE</b> - path to <code>ccache</code> executable. If not set then initialized from <code>NDK_CCACHE</code> environment variable.</li>
</ul>
<h1><a class="anchor" id="autotoc_md91"></a>
Advanced <em>android-cmake</em> options</h1>
<p>Normally <em>android-cmake</em> users are not supposed to touch these variables but they might be useful to workaround some build issues:</p>
<ul>
<li><b>ANDROID_FORCE_ARM_BUILD</b> = <code>OFF</code> - generate 32-bit ARM instructions instead of Thumb. Applicable only for arm ABIs and is forced to be <code>ON</code> for <code>armeabi-v6 with VFP</code>;</li>
<li><b>ANDROID_NO_UNDEFINED</b> = <code>ON</code> - show all undefined symbols as linker errors;</li>
<li><b>ANDROID_SO_UNDEFINED</b> = <code>OFF</code> - allow undefined symbols in shared libraries;<ul>
<li>actually it is turned <code>ON</code> by default for NDK older than <code>r7</code></li>
</ul>
</li>
<li><b>ANDROID_STL_FORCE_FEATURES</b> = <code>ON</code> - automatically configure rtti and exceptions support based on C++ runtime;</li>
<li><b>ANDROID_NDK_LAYOUT</b> = <code>RELEASE</code> - inner layout of Android NDK, should be detected automatically. Possible values are:<ul>
<li><code>RELEASE</code> - public releases from Google;</li>
<li><code>LINARO</code> - NDK from Linaro project;</li>
<li><code>ANDROID</code> - NDK from AOSP.</li>
</ul>
</li>
<li><b>ANDROID_FUNCTION_LEVEL_LINKING</b> = <code>ON</code> - enables saparate putting each function and data items into separate sections and enable garbage collection of unused input sections at link time (<code>-fdata-sections -ffunction-sections -Wl,--gc-sections</code>);</li>
<li><b>ANDROID_GOLD_LINKER</b> = <code>ON</code> - use gold linker with GCC 4.6 for NDK r8b and newer (only for ARM and x86);</li>
<li><b>ANDROID_NOEXECSTACK</b> = <code>ON</code> - enables or disables stack execution protection code (<code>-Wl,-z,noexecstack</code>);</li>
<li><b>ANDROID_RELRO</b> = <code>ON</code> - Enables RELRO - a memory corruption mitigation technique (<code>-Wl,-z,relro -Wl,-z,now</code>);</li>
<li><b>ANDROID_LIBM_PATH</b> - path to <code>libm.so</code> (set to something like <code>$(TOP)/out/target/product/&lt;product_name&gt;/obj/lib/libm.so</code>) to workaround unresolved <code>sincos</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md92"></a>
Fine-tuning <code>CMakeLists.txt</code> for <em>android-cmake</em></h1>
<h2><a class="anchor" id="autotoc_md93"></a>
Recognizing Android build</h2>
<p><em>android-cmake</em> defines <code>ANDROID</code> CMake variable which can be used to add Android-specific stuff: </p><pre class="fragment">if (ANDROID)
    message(STATUS "Hello from Android build!")
endif()
</pre><p> The recommended way to identify ARM/MIPS/x86 architecture is examining <code>CMAKE_SYSTEM_PROCESSOR</code> which is set to the appropriate value:</p>
<ul>
<li><code>armv5te</code> - for <code>armeabi</code> ABI</li>
<li><code>armv6</code> - for <code>armeabi-v6 with VFP</code> ABI</li>
<li><code>armv7-a</code> - for <code>armeabi-v7a</code>, <code>armeabi-v7a with VFPV3</code> and <code>armeabi-v7a with NEON</code> ABIs</li>
<li><code>aarch64</code> - for <code>arm64-v8a</code> ABI</li>
<li><code>i686</code> - for <code>x86</code> ABI</li>
<li><code>x86_64</code> - for <code>x86_64</code> ABI</li>
<li><code>mips</code> - for <code>mips</code> ABI</li>
<li><code>mips64</code> - for <code>mips64</code> ABI</li>
</ul>
<p>Other variables that are set by <em>android-cmake</em> and can be used for the fine-grained build configuration are:</p>
<ul>
<li><code>NEON</code> - set if target ABI supports Neon;</li>
<li><code>ANDROID_NATIVE_API_LEVEL</code> - native Android API level we are building for (note: Java part of Andoid application can be built for another API level)</li>
<li><code>ANDROID_NDK_RELEASE</code> - version of the Android NDK</li>
<li><code>ANDROID_NDK_HOST_SYSTEM_NAME</code> - "windows", "linux-x86" or "darwin-x86" depending on the host platform</li>
<li><code>ANDROID_RTTI</code> - set if rtti is enabled by the runtime</li>
<li><code>ANDROID_EXCEPTIONS</code> - set if exceptions are enabled by the runtime</li>
</ul>
<h2><a class="anchor" id="autotoc_md94"></a>
Finding packages</h2>
<p>When crosscompiling CMake <code>find_*</code> commands are normally expected to find libraries and packages belonging to the same build target. So <em>android-cmake</em> configures CMake to search in Android-specific paths only and ignore your host system locations. So </p><pre class="fragment">find_package(ZLIB)
</pre><p> will surely find libz.so within the Android NDK.</p>
<p>However sometimes you need to locate a host package even when cross-compiling. For example you can be searching for your documentation generator. The <em>android-cmake</em> recommends you to use <code>find_host_package</code> and <code>find_host_program</code> macro defined in the <code>android.toolchain.cmake</code>: </p><pre class="fragment">find_host_package(Doxygen)
find_host_program(PDFLATEX pdflatex)
</pre><p> However this will break regular builds so instead of wrapping package search into platform-specific logic you can copy the following snippet into your project (put it after your top-level <code>project()</code> command): </p><pre class="fragment"># Search packages for host system instead of packages for target system
# in case of cross compilation these macro should be defined by toolchain file
if(NOT COMMAND find_host_package)
  macro(find_host_package)
    find_package(${ARGN})
  endmacro()
endif()
if(NOT COMMAND find_host_program)
  macro(find_host_program)
    find_program(${ARGN})
  endmacro()
endif()
</pre> <h2><a class="anchor" id="autotoc_md95"></a>
Compiler flags recycling</h2>
<p>Make sure to do the following in your scripts: </p><pre class="fragment">set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${my_cxx_flags}")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${my_cxx_flags}")
</pre><p> The flags will be prepopulated with critical flags, so don't loose them. Also be aware that <em>android-cmake</em> also sets configuration-specific compiler and linker flags.</p>
<h1><a class="anchor" id="autotoc_md96"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md97"></a>
Building on Windows</h2>
<p>First of all <code>cygwin</code> builds are <b>NOT supported</b> and will not be supported by <em>android-cmake</em>. To build natively on Windows you need a port of make but I recommend <a href="http://martine.github.io/ninja/">http://martine.github.io/ninja/</a> instead.</p>
<p>To build with Ninja you need:</p>
<ul>
<li>Ensure you are using CMake newer than 2.8.9;</li>
<li>Download the latest Ninja from <a href="https://github.com/martine/ninja/releases;">https://github.com/martine/ninja/releases;</a></li>
<li>Put the <code>ninja.exe</code> into your PATH (or add path to <code>ninja.exe</code> to your PATH environment variable);</li>
<li>Pass <code>-GNinja</code> to <code>cmake</code> alongside with other arguments (or choose Ninja generator in <code>cmake-gui</code>).</li>
<li>Enjoy the fast native multithreaded build :)</li>
</ul>
<p>But if you still want to stick to old make then:</p>
<ul>
<li>Get a Windows port of GNU Make:<ul>
<li>Android NDK r7 (and newer) already has <code>make.exe</code> on board;</li>
<li><code>mingw-make</code> should work as fine;</li>
<li>Download some other port. For example, this one: <a href="http://gnuwin32.sourceforge.net/packages/make.htm">http://gnuwin32.sourceforge.net/packages/make.htm</a>.</li>
</ul>
</li>
<li>Add path to your <code>make.exe</code> to system PATH or always use full path;</li>
<li>Pass <code>-G"MinGW Makefiles"</code> and <code>-DCMAKE_MAKE_PROGRAM="&lt;full/path/to/&gt;make.exe"</code><ul>
<li>It must be <code>MinGW Makefiles</code> and not <code>Unix Makefiles</code> even if your <code>make.exe</code> is not a MinGW's make.</li>
</ul>
</li>
<li>Run <code>make.exe</code> or <code>cmake --build .</code> for single-threaded build.</li>
</ul>
<h2><a class="anchor" id="autotoc_md98"></a>
Projects with assembler files</h2>
<p>The <em>android-cmake</em> should correctly handle projects with assembler sources (<code>*.s</code> or <code>*.S</code>). But if you still facing problems with assembler then try to upgrade your CMake to version newer than 2.8.5</p>
<h1><a class="anchor" id="autotoc_md99"></a>
Copying</h1>
<p><em>android-cmake</em> is distributed under the terms of <a href="http://opensource.org/licenses/BSD-3-Clause">BSD 3-Clause License</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
