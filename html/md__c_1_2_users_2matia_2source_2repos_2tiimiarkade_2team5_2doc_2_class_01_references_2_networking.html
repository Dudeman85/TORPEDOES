<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tiimi Arkade: Networking Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Tiimi Arkade<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__c_1_2_users_2matia_2source_2repos_2tiimiarkade_2team5_2doc_2_class_01_references_2_networking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Networking Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md16"></a> </p>
<h1><a class="anchor" id="autotoc_md17"></a>
Enet</h1>
<p>This engine uses Enet for networking, that means that to host a server on the net you need to forward a UDP port.<br  />
 Enet had good documentation here: <a href="http://enet.bespin.org/Tutorial.html">http://enet.bespin.org/Tutorial.html</a></p>
<hr  />
 <h1><a class="anchor" id="autotoc_md19"></a>
Client &amp; Server</h1>
<p>First you must create a <b>client.</b> </p><div class="fragment"><div class="line"><span class="comment">//IP and port should be those of the server</span></div>
<div class="line">std::string ipAddress = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;</div>
<div class="line"><a class="code hl_typedef" href="assimp-5_80_81_2contrib_2rapidjson_2include_2rapidjson_2msinttypes_2stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> port = 2315;</div>
<div class="line"><span class="comment">//How many communication channels can be used</span></div>
<div class="line"><span class="keywordtype">size_t</span> channelLimit = 4;</div>
<div class="line"><span class="comment">//Create the client, this returns a Connection struct with information about the ENet connection</span></div>
<div class="line">Connection client = CreateClient(ipAddress, port, channelLimit);</div>
<div class="ttc" id="aassimp-5_80_81_2contrib_2rapidjson_2include_2rapidjson_2msinttypes_2stdint_8h_html_a273cf69d639a59973b6019625df33e30"><div class="ttname"><a href="assimp-5_80_81_2contrib_2rapidjson_2include_2rapidjson_2msinttypes_2stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a></div><div class="ttdeci">unsigned short uint16_t</div><div class="ttdef"><b>Definition</b> stdint.h:125</div></div>
</div><!-- fragment --><p> Then you need a <b>server</b> to which all clients connect to. This doesn't have to be in a seperate executable.</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="assimp-5_80_81_2contrib_2rapidjson_2include_2rapidjson_2msinttypes_2stdint_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a> port = 2315;</div>
<div class="line"><span class="comment">//How many communication channels can be used</span></div>
<div class="line"><span class="keywordtype">size_t</span> channelLimit = 4;</div>
<div class="line"><span class="comment">//The max client count</span></div>
<div class="line"><span class="keywordtype">size_t</span> peerCount = 2;</div>
<div class="line">Connection server = CreateHost(port, channelLimit, peerCount);</div>
</div><!-- fragment --><p>Then you need to update ENet every frame which sends and fetches packets. It has three callbacks you need to provide: OnClientConnect, OnClientDisconnect, and OnClientReceive.<br  />
 There is also a timeout in milliseconds which determines how long to wait for any events. When only sending data this should be 0, but if you also expect to receive data it should be &gt;0.</p>
<div class="fragment"><div class="line"><span class="comment">//Define the callbacks, these could also be lambdas.</span></div>
<div class="line"><span class="comment">//The must be declared exactly like this with the same return types and arguments</span></div>
<div class="line"><span class="keywordtype">bool</span> OnClientConnect(<span class="keywordtype">int</span> peerId)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> OnClientDisconnect(<span class="keywordtype">int</span> peerId)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">bool</span> OnClientReceive(<span class="keyword">const</span> Message&amp; msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Updates Enet calling all relevant callbacks, this usually should be called a maximum of once per frame</span></div>
<div class="line"><a class="code hl_function" href="namespaceengine.html#ad449e6a363b63ea759c2de34d4441a2e">UpdateEnet</a>(client, OnClientConnect, OnClientDisconnect, OnClientReceive, 10);</div>
<div class="ttc" id="anamespaceengine_html_ad449e6a363b63ea759c2de34d4441a2e"><div class="ttname"><a href="namespaceengine.html#ad449e6a363b63ea759c2de34d4441a2e">engine::UpdateEnet</a></div><div class="ttdeci">void UpdateEnet(Connection &amp;conn, auto connectFunc, auto disconnectFunc, auto receiveFunc, int timeOut)</div><div class="ttdef"><b>Definition</b> Networking.h:151</div></div>
</div><!-- fragment --><p>Finally, you have to close the connection after the game ends</p>
<div class="fragment"><div class="line"><span class="comment">//Close the connection after game ends</span></div>
<div class="line">close(connection);</div>
<div class="line"><a class="code hl_function" href="group__global.html#gad62cf417e08a2b98d48572a336f7db25">enet_deinitialize</a>();</div>
<div class="ttc" id="agroup__global_html_gad62cf417e08a2b98d48572a336f7db25"><div class="ttname"><a href="group__global.html#gad62cf417e08a2b98d48572a336f7db25">enet_deinitialize</a></div><div class="ttdeci">ENET_API void enet_deinitialize(void)</div><div class="ttdef"><b>Definition</b> unix.c:73</div></div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md21"></a>
Sending Data</h1>
<p>Enet expects data to be in binary format therefore you need to serialize everything before sending it. You can use the Serialize() function to serialize any aggregate struct which is contained entirely on the stack. To serialize anything else you need to write your own serialization function.<br  />
 The SendData() function calls Serialize() for you so you only need to give it the object though.</p>
<div class="fragment"><div class="line"><span class="comment">//Send a Transform component to the server</span></div>
<div class="line">Transform <a class="code hl_variable" href="afcover_8h.html#acd69ea1d7236c41e46abe58713ad3c35">t</a>{ .position = Vector3(100, 100, 0), .rotation = Vector3(0, 0, 45), .scale = Vector3(50) };</div>
<div class="line"><span class="comment">//Arguments are connection, data, channel number, peer id (-1 means all), and packet flags (reliable by default)</span></div>
<div class="line">SendData(client, <a class="code hl_variable" href="afcover_8h.html#acd69ea1d7236c41e46abe58713ad3c35">t</a>, 0);</div>
<div class="ttc" id="aafcover_8h_html_acd69ea1d7236c41e46abe58713ad3c35"><div class="ttname"><a href="afcover_8h.html#acd69ea1d7236c41e46abe58713ad3c35">t</a></div><div class="ttdeci">small capitals from c petite p scientific f s t</div><div class="ttdef"><b>Definition</b> afcover.h:96</div></div>
</div><!-- fragment --><p>Strings are a special case since their data is on the heap. The SendData() function can accept them without issues.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Receiving Data</h1>
<p>Data is received when UpdateEnet() is called, it will then call the OnClientReceive callback with a Message struct which contains the data. You then need to deserialize it into the right type.</p>
<div class="fragment"><div class="line"><span class="comment">//Callback</span></div>
<div class="line"><span class="keywordtype">void</span> OnClientReceive(<span class="keyword">const</span> Message&amp; msg)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Receive Transform on chanel 1</span></div>
<div class="line">    <span class="keywordflow">if</span>(msg.chanelID == 1)</div>
<div class="line">        Transform transform = Deserialize&lt;Transform&gt;(msg.data);</div>
<div class="line">    <span class="comment">//Receive string on chanel 2</span></div>
<div class="line">    <span class="keywordflow">if</span>(msg.chanelID == 2)</div>
<div class="line">        <span class="comment">//Strings are deserialized in a special way</span></div>
<div class="line">        std::string <a class="code hl_variable" href="sndfile__save_8m.html#a4b99ff73a8a869319570237b5c57ab03">str</a> = DeserializeString(msg.data, msg.dataLength)</div>
<div class="line"> </div>
<div class="line">    return <a class="code hl_define" href="ftrandom_8c.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aftrandom_8c_html_a41f9c5fb8b08eb5dc3edce4dcb37fee7"><div class="ttname"><a href="ftrandom_8c.html#a41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a></div><div class="ttdeci">#define true</div><div class="ttdef"><b>Definition</b> ftrandom.c:51</div></div>
<div class="ttc" id="asndfile__save_8m_html_a4b99ff73a8a869319570237b5c57ab03"><div class="ttname"><a href="sndfile__save_8m.html#a4b99ff73a8a869319570237b5c57ab03">str</a></div><div class="ttdeci">str</div><div class="ttdef"><b>Definition</b> sndfile_save.m:49</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
